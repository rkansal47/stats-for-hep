
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Expected Significances and Limits &#8212; Stats for HEP</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '04-expected-significance-and-limits';</script>
    <link rel="icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Asymptotic Form of the MLE" href="05-asymptotic-form-mle.html" />
    <link rel="prev" title="4. Confidence Intervals and Limits" href="03-intervals-and-limits.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="main.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Stats for HEP - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Stats for HEP - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/rkansal47/stats-for-hep/blob/gh-pages/stats-for-hep.pdf?raw=true" title="PDF" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-download fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PDF</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="main.html">
                    Stats for HEP
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00-introduction.html">1. Introduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">I.  Frequentist Statistics at the LHC</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-likelihood.html">2. Introduction to Likelihoods and Test Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-hypothesis-testing.html">3. Hypothesis Testing and Discovery Significance</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-intervals-and-limits.html">4. Confidence Intervals and Limits</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">5. Expected Significances and Limits</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">II.  Asymptotic Formulae</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="05-asymptotic-form-mle.html">6. Asymptotic Form of the MLE</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-asymptotic-formulae.html">7. Asymptotic Form of the Profile Likelihood Ratio</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/rkansal47/stats-for-hep" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/rkansal47/stats-for-hep/edit/main/04-expected-significance-and-limits.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/rkansal47/stats-for-hep/issues/new?title=Issue%20on%20page%20%2F04-expected-significance-and-limits.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Expected Significances and Limits</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">5.1. Recap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-significance">5.2. Expected Significance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-limit">5.3. Expected Limit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">5.4. Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="expected-significances-and-limits">
<span id="sec-expected"></span><h1><span class="section-number">5. </span>Expected Significances and Limits<a class="headerlink" href="#expected-significances-and-limits" title="Link to this heading">#</a></h1>
<section id="recap">
<h2><span class="section-number">5.1. </span>Recap<a class="headerlink" href="#recap" title="Link to this heading">#</a></h2>
<p>In <a class="reference internal" href="01-likelihood.html#sec-likelihood"><span class="std std-numref">Chapter 2</span></a>, we defined our probability model and likelihood function for a simple one bin counting experiment with <span class="math notranslate nohighlight">\(n\)</span> events, <span class="math notranslate nohighlight">\(s\)</span> expected signal (for a signal strength <span class="math notranslate nohighlight">\(\mu\)</span> of 1), and <span class="math notranslate nohighlight">\(b\)</span> expected background in our signal region, and <span class="math notranslate nohighlight">\(m\)</span> events, <span class="math notranslate nohighlight">\(b\)</span> expected background, in our control region:</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>As discussed in <a class="reference internal" href="03-intervals-and-limits.html#sec-intervals"><span class="std std-numref">Chapter 4</span></a>, the old parameter of interest (POI) <span class="math notranslate nohighlight">\(s\)</span> has been re-parametrized as <span class="math notranslate nohighlight">\(\mu\cdot s\)</span>, where <span class="math notranslate nohighlight">\(\mu\)</span> is now our (POI), called the “signal strength”.</p>
</aside>
<div class="math notranslate nohighlight" id="equation-4model">
<span class="eqno">(5.1)<a class="headerlink" href="#equation-4model" title="Link to this equation">#</a></span>\[
P(n, m; \mu, b) = \frac{(\mu s+b)^n e^{-(\mu s+b)}}{n!} \cdot \frac{b^m e^{-b}}{m!} = L(\mu, b),
\]</div>
<p>and our test statistic <span class="math notranslate nohighlight">\(\tilde{t}_\mu\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-4ts-tilde">
<span class="eqno">(5.2)<a class="headerlink" href="#equation-4ts-tilde" title="Link to this equation">#</a></span>\[\begin{split}
\tilde{\lambda}(\mu) = \left\{
    \begin{array}{ll}
      \frac{L(\mu, \hat{\hat{b}}(\mu))}{L(\hat{\mu}, \hat{b})}, &amp; \mbox{$\hat{\mu}\geq0$}.\\
      \frac{L(\mu, \hat{\hat{b}}(\mu))}{L(0, \hat{\hat{b}}(0))}, &amp; \mbox{$\hat{\mu}&lt;0$}.
    \end{array}
  \right., \quad \tilde{t}_\mu=-2\ln \tilde{\lambda}(\mu),
\end{split}\]</div>
<p>and solved for <span class="math notranslate nohighlight">\(\hat{\mu}, \hat{b}, \hat{\hat{b}}(\mu)\)</span> for given <span class="math notranslate nohighlight">\(n, m\)</span> to find an analytic form for <span class="math notranslate nohighlight">\(t_\mu\)</span>.</p>
<p>In <a class="reference internal" href="02-hypothesis-testing.html#sec-hypothesis-testing"><span class="std std-numref">Chapter 3</span></a>, we translated this to a probability distribution of <span class="math notranslate nohighlight">\(\tilde{t}_\mu\)</span> under a particular signal hypothesis <span class="math notranslate nohighlight">\(H_\mu\)</span>, and quantified the compatibility of our observation based on the <span class="math notranslate nohighlight">\(p\)</span>-value <span class="math notranslate nohighlight">\(p_\mu\)</span> of the observed test statistic <span class="math notranslate nohighlight">\(\tilde{t}_\mu^\mathrm{obs}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-4pvalue">
<span class="eqno">(5.3)<a class="headerlink" href="#equation-4pvalue" title="Link to this equation">#</a></span>\[
p_\mu = \int_{\tilde{t}_\mathrm{obs}}^{\infty}p(\tilde{t}_\mu|\mu)\mathrm d \tilde{t}_\mu,
\]</div>
<p>and it’s associated significance.</p>
<p>In <a class="reference internal" href="03-intervals-and-limits.html#sec-intervals"><span class="std std-numref">Chapter 4</span></a>, we extended this to deriving confidence intervals for parameters of interest by solving for a particular <span class="math notranslate nohighlight">\(p\)</span>-value:</p>
<div class="math notranslate nohighlight" id="equation-4cl">
<span class="eqno">(5.4)<a class="headerlink" href="#equation-4cl" title="Link to this equation">#</a></span>\[
p = 1 - \mathrm{CL} = \int_{\tilde{t}^\mathrm{obs}_\mu}^{\infty}p(\tilde{t}_\mu|\mu_\pm)\mathrm d \tilde{t}_\mu.
\]</div>
<p>We also defined a new test statistic <span class="math notranslate nohighlight">\(\tilde{q}_\mu\)</span> for upper limits:</p>
<div class="math notranslate nohighlight" id="equation-4qs-tilde">
<span class="eqno">(5.5)<a class="headerlink" href="#equation-4qs-tilde" title="Link to this equation">#</a></span>\[\begin{split}
    \tilde{q}(\mu) = \left\{
      \begin{array}{ll}
        \tilde{t}(\mu), &amp; \mbox{$\hat{\mu} &lt; \mu$}.\\
        0, &amp; \mbox{$\hat{\mu} \geq \mu$}.
      \end{array}
    \right.
    = \left\{
    \begin{array}{ll}
        -2\ln\frac{L(\mu, \hat{\hat{b}}(\mu))}{L(0, \hat{\hat{b}}(0))}, &amp; \mbox{$\hat{\mu}&lt;0$}.\\
        -2\ln\frac{L(\mu, \hat{\hat{b}}(\mu))}{L(\hat{\mu}, \hat{b})}, &amp; \mbox{0 $\leq \hat{\mu} &lt; \mu$}.\\
        0, &amp; \mbox{$\hat{\mu} \geq \mu$}.
      \end{array}
    \right.
\end{split}\]</div>
<p>and introduced the CL<span class="math notranslate nohighlight">\(_s\)</span> criterion used in HEP in lieu of the standard <span class="math notranslate nohighlight">\(p\)</span>-value to avoid excluding signals for which our experiment lacks sensitivity:</p>
<div class="math notranslate nohighlight" id="equation-4pmu-prime">
<span class="eqno">(5.6)<a class="headerlink" href="#equation-4pmu-prime" title="Link to this equation">#</a></span>\[
p_\mu' = \cfrac{p_\mu}{1 - p_b},
\]</div>
<p>Code from previous chapters:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span><span class="p">,</span> <span class="n">poisson</span><span class="p">,</span> <span class="n">chi2</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_poisson_nofactorial</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">mu</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">log_likelihood_nofactorial</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">log_poisson_nofactorial</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">log_poisson_nofactorial</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">shat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">-</span> <span class="n">m</span>


<span class="k">def</span> <span class="nf">bhat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m</span>


<span class="k">def</span> <span class="nf">bhathat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Using the quadratic formula and only the positive solution&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">m</span><span class="p">))</span> <span class="o">/</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">t_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;-2ln(lambda), b can optionally be fixed (for demo below)&quot;&quot;&quot;</span>
    <span class="n">bhh</span><span class="p">,</span> <span class="n">bh</span> <span class="o">=</span> <span class="p">(</span><span class="n">bhathat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">bhat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span> <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">log_likelihood_nofactorial</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">bhh</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="n">log_likelihood_nofactorial</span><span class="p">(</span><span class="n">shat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">bh</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">t_zero_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alternative test statistic when shat &lt; 0&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">log_likelihood_nofactorial</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">bhathat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">log_likelihood_nofactorial</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bhathat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">t_tilde_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="c1">#     s, n, m = [np.array(x) for x in (s, n, m)]  # convert to numpy arrays</span>
    <span class="n">neg_shat_mask</span> <span class="o">=</span> <span class="n">shat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="c1"># find when s^ is &lt; 0</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
    <span class="n">t_zero</span> <span class="o">=</span> <span class="n">t_zero_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="c1"># replace values where s^ &lt; 0 with lam_zero</span>
    <span class="n">ts</span><span class="p">[</span><span class="n">neg_shat_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_zero</span><span class="p">[</span><span class="n">neg_shat_mask</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">q_tilde_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

    <span class="n">neg_shat_mask</span> <span class="o">=</span> <span class="n">shat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="c1"># find when s^ is &lt; 0</span>
    <span class="n">t_zero</span> <span class="o">=</span> <span class="n">t_zero_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="c1"># replace values where s^ &lt; 0 with lam_zero</span>
    <span class="n">ts</span><span class="p">[</span><span class="n">neg_shat_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_zero</span><span class="p">[</span><span class="n">neg_shat_mask</span><span class="p">]</span>

    <span class="n">upper_shat_mask</span> <span class="o">=</span> <span class="n">shat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">s</span>
    <span class="n">ts</span><span class="p">[</span><span class="n">upper_shat_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_toys_sb</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate toy data for a given s and b&quot;&quot;&quot;</span>
    <span class="c1"># sample n, m according to our data model (Eq. 1)</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_toys</span><span class="p">),</span> <span class="n">poisson</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_toys</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span>


<span class="k">def</span> <span class="nf">get_toys</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate toy data for a given s and observed n and m&quot;&quot;&quot;</span>
    <span class="c1">#  use b^^ for p(t_s|s) as recommended by Ref. 2</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">bhathat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">get_toys_sb</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_p_ts</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">,</span> <span class="n">toy_s</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the t_tilde_s test statistic distribution via toys.</span>
<span class="sd">    By default, the s we&#39;re testing is the same as the s we&#39;re using for toys,</span>
<span class="sd">    but this can be changed if necessary (as you will see later).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">toy_s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">toy_s</span> <span class="o">=</span> <span class="n">test_s</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">get_toys</span><span class="p">(</span><span class="n">toy_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t_tilde_s</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_ps_val</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">,</span> <span class="n">toy_s</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;p value&quot;&quot;&quot;</span>
    <span class="n">t_tilde_ss</span> <span class="o">=</span> <span class="n">get_p_ts</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">,</span> <span class="n">toy_s</span><span class="p">)</span>
    <span class="n">t_obs</span> <span class="o">=</span> <span class="n">t_tilde_s</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">)</span>
    <span class="n">p_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">t_tilde_ss</span> <span class="o">&gt;</span> <span class="n">t_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">t_tilde_ss</span><span class="p">,</span> <span class="n">t_obs</span>


<span class="k">def</span> <span class="nf">get_p_qs</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">,</span> <span class="n">toy_s</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the q_tilde_s test statistic distribution via toys.</span>
<span class="sd">    By default, the s we&#39;re testing is the same as the s we&#39;re using for toys,</span>
<span class="sd">    but this can be changed if necessary (as you will see later).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">toy_s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">toy_s</span> <span class="o">=</span> <span class="n">test_s</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">get_toys</span><span class="p">(</span><span class="n">toy_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">q_tilde_s</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_pval_qs</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">,</span> <span class="n">toy_s</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;p value&quot;&quot;&quot;</span>
    <span class="n">q_tilde_ss</span> <span class="o">=</span> <span class="n">get_p_qs</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">,</span> <span class="n">toy_s</span><span class="p">)</span>
    <span class="n">q_obs</span> <span class="o">=</span> <span class="n">q_tilde_s</span><span class="p">(</span><span class="n">test_s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">)</span>
    <span class="n">p_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">q_tilde_ss</span> <span class="o">&gt;</span> <span class="n">q_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_tilde_ss</span><span class="p">,</span> <span class="n">q_obs</span>


<span class="k">def</span> <span class="nf">get_limits_CLs</span><span class="p">(</span><span class="n">s_scan</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">CL</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">):</span>
    <span class="n">p_cls_scan</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># saving p-value for each s</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s_scan</span><span class="p">:</span>
        <span class="n">p_mu</span><span class="p">,</span> <span class="n">t_tilde_sb</span><span class="p">,</span> <span class="n">t_obs</span> <span class="o">=</span> <span class="n">get_ps_val</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
        <span class="n">p_b</span><span class="p">,</span> <span class="n">t_tilde_sb</span><span class="p">,</span> <span class="n">t_obs</span> <span class="o">=</span> <span class="n">get_ps_val</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">,</span> <span class="n">toy_s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">p_b</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p_b</span>
        <span class="n">p_cls_scan</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_mu</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_b</span><span class="p">))</span>

    <span class="c1"># find the values of s that give p_value ~= 1 - CL</span>
    <span class="n">pv_cl_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_cls_scan</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">CL</span><span class="p">))</span>
    <span class="n">half_num_s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s_scan</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">s_low</span> <span class="o">=</span> <span class="n">s_scan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pv_cl_diff</span><span class="p">[:</span><span class="n">half_num_s</span><span class="p">])[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">s_high</span> <span class="o">=</span> <span class="n">s_scan</span><span class="p">[</span><span class="n">half_num_s</span><span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pv_cl_diff</span><span class="p">[</span><span class="n">half_num_s</span><span class="p">:])[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">s_low</span><span class="p">,</span> <span class="n">s_high</span>


<span class="k">def</span> <span class="nf">get_upper_limit_CLs</span><span class="p">(</span><span class="n">s_scan</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">CL</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">):</span>
    <span class="n">p_cls_scan</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># saving p-value for each s</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s_scan</span><span class="p">:</span>
        <span class="n">p_mu</span><span class="p">,</span> <span class="n">q_tilde_sb</span><span class="p">,</span> <span class="n">q_obs</span> <span class="o">=</span> <span class="n">get_pval_qs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
        <span class="n">p_b</span><span class="p">,</span> <span class="n">q_tilde_sb</span><span class="p">,</span> <span class="n">q_obs</span> <span class="o">=</span> <span class="n">get_pval_qs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">m_obs</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">,</span> <span class="n">toy_s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">p_b</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p_b</span>
        <span class="n">p_cls_scan</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_mu</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_b</span><span class="p">))</span>

    <span class="c1"># find the values of s that give p_value ~= 1 - CL</span>
    <span class="n">pv_cl_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_cls_scan</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">CL</span><span class="p">))</span>
    <span class="n">s_upper</span> <span class="o">=</span> <span class="n">s_scan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pv_cl_diff</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">s_upper</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="expected-significance">
<h2><span class="section-number">5.2. </span>Expected Significance<a class="headerlink" href="#expected-significance" title="Link to this heading">#</a></h2>
<p>The focus so far has been only on evaluating the <em>results</em> of experiments.
However, it is equally important to characterize the expected sensitivity of the experiment <em>before</em> running it (or before looking at the data).</p>
<p>Concretely, let’s continue with our simple example and say we expect <span class="math notranslate nohighlight">\(b = 10\)</span> background events and, for a signal strength <span class="math notranslate nohighlight">\(\mu = 1\)</span>, <span class="math notranslate nohighlight">\(s = 10\)</span> signal events. How do we tell if this experiment is at all useful for discovering this signal, i.e., does it have any sensitivity to the signal?  One way is to calculate the significance with which we expect to exclude the background-only hypothesis if the signal were, in fact, to exist.</p>
<p>Practically, this means we are testing <span class="math notranslate nohighlight">\(H_0\)</span> and, hence, need <span class="math notranslate nohighlight">\(p(\tilde{t}_0|\mu = 0)\)</span> as before. However, now we also need the distribution of the test statistic <span class="math notranslate nohighlight">\(\tilde{t}_0\)</span> under the <em>background + signal</em> hypothesis <span class="math notranslate nohighlight">\(p(\tilde{t}_0|\mu = 1)\)</span>.
Then, by calculating the significance for each sampled <span class="math notranslate nohighlight">\(\tilde{t}_0\)</span> under <span class="math notranslate nohighlight">\(H_{\mu = 1}\)</span>, we can estimate the distribution of expected significances.</p>
<p>As always, things should hopefully be clearer with code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_toys</span> <span class="o">=</span> <span class="mi">30000</span>
<span class="c1"># generate toys under signal + background hypothesis</span>
<span class="n">s</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span>
<span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">get_toys_sb</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
<span class="c1"># sample t_0 under s + b hypothesis</span>
<span class="n">t_tilde_0s</span> <span class="o">=</span> <span class="n">t_tilde_s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="n">median_t0s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">t_tilde_0s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>

<span class="c1"># generate toys under background-only hypothesis</span>
<span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">get_toys_sb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
<span class="c1"># sample t_0 under b-only hypothesis</span>
<span class="n">t_tilde_00</span> <span class="o">=</span> <span class="n">t_tilde_s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

<span class="c1"># convert sampled t_0s under s + b hypothesis into p-values wrt t_0s under b-only hypothesis</span>
<span class="c1"># by calculating the p-value for each t_0 under the s + b hypothesis</span>
<span class="n">p_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">t_tilde_00</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">t_tilde_0s</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># convert to significances</span>
<span class="n">Zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_values</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">median_Z</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">Zs</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_t0_s0</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">t_tilde_00</span><span class="p">,</span> <span class="n">t_tilde0s</span><span class="p">,</span> <span class="n">median_t0s</span><span class="p">,</span> <span class="n">hlim</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mf">2.4</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">t_tilde_00</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hlim</span><span class="p">,</span> <span class="mi">41</span><span class="p">),</span>
        <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$p(\tilde</span><span class="si">{t}</span><span class="s2">_0|\mu = 0)$&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">t_tilde_0s</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hlim</span><span class="p">,</span> <span class="mi">41</span><span class="p">),</span>
        <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$p(\tilde</span><span class="si">{t}</span><span class="s2">_0|\mu = 1)$&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
        <span class="n">median_t0s</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">ylim</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;Median[$p(\tilde</span><span class="se">{{</span><span class="s2">t</span><span class="se">}}</span><span class="s2">_0|\mu = 1)$] = </span><span class="si">{</span><span class="n">median_t0s</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{t}</span><span class="s2">_0$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">plot_signs</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Zs</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Zs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$Z$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$p(Z)$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">median_Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ylim</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Median Z = </span><span class="si">{</span><span class="n">median_Z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plot_t0_s0</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_tilde_00</span><span class="p">,</span> <span class="n">t_tilde_0s</span><span class="p">,</span> <span class="n">median_t0s</span><span class="p">)</span>
<span class="n">plot_signs</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Zs</span><span class="p">,</span> <span class="n">median_Z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<figure class="align-default" id="expz">
<img alt="_images/fa7196023f7b66c18e607f96c9ec6d676543c4f0f991fc1d8144a647d70084e8.png" src="_images/fa7196023f7b66c18e607f96c9ec6d676543c4f0f991fc1d8144a647d70084e8.png" />
<figcaption>
<p><span class="caption-number">Fig. 5.1 </span><span class="caption-text">Left: Distributions of <span class="math notranslate nohighlight">\(\tilde{t}_0\)</span> under the background-only and signal hypotheses using 30,000 toys each. The median of the latter is marked in red. Right: Distribution of the significances (with respect to the background-only hypothesis) of each sampled <span class="math notranslate nohighlight">\(\tilde{t}_0\)</span> under the signal hypothesis.</span><a class="headerlink" href="#expz" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>These quantiles correspond to the cumulative probabilities for a standard Gaussian:</p>
<figure class="align-center" id="gaussian-quantiles">
<img alt="_images/gaussian_quantiles.png" src="_images/gaussian_quantiles.png" />
<figcaption>
<p><span class="caption-number">Fig. 5.2 </span><span class="caption-text">From Ref. <span id="id1">[<a class="reference internal" href="main.html#id7" title="Caroline Stiller. Baseline assessment and effect of a supplementary community-based nutrition intervention study on the prevention/treatment of anemia among young Adivasi children in West Bengal, India. PhD thesis, University of Hohenheim, 01 2021.">4</a>]</span>.</span><a class="headerlink" href="#gaussian-quantiles" title="Link to this image">#</a></p>
</figcaption>
</figure>
</aside>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We usually quote the <strong>median</strong> of this distribution as the expected significance, since the median is “invariant” to monotonic transformations (i.e., the median <span class="math notranslate nohighlight">\(p\)</span>-value will always correspond to the median <span class="math notranslate nohighlight">\(Z\)</span> as well, whereas the mean <span class="math notranslate nohighlight">\(p\)</span>-value will not correspond to the mean <span class="math notranslate nohighlight">\(Z\)</span>).
Similarly, we quote the 16%/84% and 2%/98% quantiles as the <span class="math notranslate nohighlight">\(\pm 1\sigma\)</span> and <span class="math notranslate nohighlight">\(\pm 2\sigma\)</span>, respectively, expected significances.</p>
</div>
<p>In this case, we find the median expected significance to be .</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>This is another benefit of considering the median.</p>
</aside>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that instead of converting each sampled <span class="math notranslate nohighlight">\(\tilde{t}\)</span> under <span class="math notranslate nohighlight">\(H_{\mu=1}\)</span> into a significance and finding the median of that distribution, as in <a class="reference internal" href="#expz"><span class="std std-numref">Fig. 5.1</span></a> (right), we could have directly used the significance of the median <span class="math notranslate nohighlight">\(\tilde{t}\)</span> under <span class="math notranslate nohighlight">\(H_{\mu=1}\)</span> (<a class="reference internal" href="#expz"><span class="std std-numref">Fig. 5.1</span></a>, left). We will do this below for the expected limit.</p>
</div>
</section>
<section id="expected-limit">
<h2><span class="section-number">5.3. </span>Expected Limit<a class="headerlink" href="#expected-limit" title="Link to this heading">#</a></h2>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>95% is the standard confidence level used for upper limits in HEP.</p>
</aside>
<p>The other figure of merit we care about in searches is the upper limit set on the signal strength.
To derive the <em>expected</em> limit, we do the opposite of the above and ask, if the signal were not to exist, what value of <span class="math notranslate nohighlight">\(\mu\)</span> would we expect to exclude at the 95% confidence level.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>Note that <span class="math notranslate nohighlight">\(p_b = \int^{\mathrm{median}[p(\tilde{q}_\mu|0)]}_{-\infty}p(\tilde{q}_\mu|0)\mathrm d \tilde{q}_\mu = 0.5\)</span> by definition, so we can plug that in directly into Eq. <a class="reference internal" href="#equation-4pmu-prime">(5.6)</a>. (Same goes for any other quantile.)</p>
</aside>
<p>This means we need:</p>
<ol class="arabic simple">
<li><p>The distribution <span class="math notranslate nohighlight">\(p(\tilde{q}_\mu|\mu)\)</span> as in Part 3 to solve for <span class="math notranslate nohighlight">\(\mu^+\)</span> in Eq. <a class="reference internal" href="#equation-4cl">(5.4)</a> and be able to do the upper limit calculation;</p></li>
<li><p><span class="math notranslate nohighlight">\(p(\tilde{q}_\mu|0)\)</span> (or, as we’ll see, just its median / quantiles) to get the expected <span class="math notranslate nohighlight">\(\tilde{q}_\mu^\mathrm{obs}\)</span> for different signal strengths (<span class="math notranslate nohighlight">\(\mu\)</span>) under the background-only hypothesis: and, furthermore,</p></li>
<li><p>To scan over the different signal strengths to find the <span class="math notranslate nohighlight">\(\mu\)</span> that results in a median <span class="math notranslate nohighlight">\(p\)</span>-value of 0.05 (or rather <span class="math notranslate nohighlight">\(p_\mu'\)</span> value, from Eq. <a class="reference internal" href="#equation-4pmu-prime">(5.6)</a>, since we’re using the CL<span class="math notranslate nohighlight">\(_s\)</span> method for upper limits).</p></li>
</ol>
<p>First, let’s look at the first two steps for just the <span class="math notranslate nohighlight">\(\mu = 1\)</span> signal strength, where we expect <span class="math notranslate nohighlight">\(s = 10, b = 10\)</span> signal and background events like above.
This is similar to, and essentially an inversion of, the procedure for the expected significance: we’re now finding the median expected <span class="math notranslate nohighlight">\(p_{\mu=1}'\)</span>-value with respect to the signal + background hypothesis, for test statistics <span class="math notranslate nohighlight">\(\tilde{q}_\mu\)</span> sampled under the background-only hypothesis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_toys</span> <span class="o">=</span> <span class="mi">30000</span>
<span class="n">exp_s</span><span class="p">,</span> <span class="n">exp_b</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span>
<span class="c1"># generate toys under signal + background hypothesis</span>
<span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">get_toys_sb</span><span class="p">(</span><span class="n">exp_s</span><span class="p">,</span> <span class="n">exp_b</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
<span class="c1"># sample q under s + b hypothesis</span>
<span class="n">q_tilde_ss</span> <span class="o">=</span> <span class="n">q_tilde_s</span><span class="p">(</span><span class="n">exp_s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

<span class="c1"># generate toys under background-only hypothesis</span>
<span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">get_toys_sb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exp_b</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
<span class="c1"># sample t_0 under b-only hypothesis</span>
<span class="n">q_tilde_s0</span> <span class="o">=</span> <span class="n">q_tilde_s</span><span class="p">(</span><span class="n">exp_s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="n">median_qs0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">q_tilde_s0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>

<span class="c1"># CL_s</span>
<span class="n">p_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">q_tilde_ss</span> <span class="o">&gt;=</span> <span class="n">median_qs0</span><span class="p">)</span>
<span class="n">p_b</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># we&#39;re looking at the median of p(q_mu | 0) so, by definition, this is 0.5</span>
<span class="n">p_muprime</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">p_mu</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_b</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">hlim</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">ylim</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">q_tilde_ss</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hlim</span><span class="p">,</span> <span class="mi">41</span><span class="p">),</span>
    <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$p(\tilde</span><span class="si">{q}</span><span class="s2">_\mu|1)$&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">q_tilde_s0</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hlim</span><span class="p">,</span> <span class="mi">41</span><span class="p">),</span>
    <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$p(\tilde</span><span class="si">{q}</span><span class="s2">_\mu|0)$&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
    <span class="n">median_qs0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="n">ylim</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;Median[$p(\tilde</span><span class="se">{{</span><span class="s2">q</span><span class="se">}}</span><span class="s2">_\mu|0)$] = </span><span class="si">{</span><span class="n">median_qs0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="sa">rf</span><span class="s2">&quot;$p_\mu&#39; = </span><span class="si">{</span><span class="n">p_muprime</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{q}</span><span class="s2">_\mu$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<figure class="align-default" id="explim">
<img alt="_images/795ccfd8253d99616f2fa2ed7d2042133e35a3a2682fc8ea19195add186bb930.png" src="_images/795ccfd8253d99616f2fa2ed7d2042133e35a3a2682fc8ea19195add186bb930.png" />
<figcaption>
<p><span class="caption-number">Fig. 5.3 </span><span class="caption-text">Calculating the median expected <span class="math notranslate nohighlight">\(p_{\mu=1}'\)</span>-value with respect to the signal + background hypothesis, for test statistics <span class="math notranslate nohighlight">\(	ilde{q}_\mu\)</span> sampled under the background-only hypothesis. p(<span class="math notranslate nohighlight">\(	ilde{q}_\mu\)</span>|1) and p(<span class="math notranslate nohighlight">\(	ilde{q}_\mu\)</span>|0) are estimated using 30,000 toys each. Then, the median p(<span class="math notranslate nohighlight">\(	ilde{q}_\mu\)</span>|0) (red) is used to calculate the <span class="math notranslate nohighlight">\(p_{\mu}'\)</span>-value following the CL<span class="math notranslate nohighlight">\(_s\)</span> criterion (from Part 3).</span><a class="headerlink" href="#explim" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<p>The difference with respect to calculating the expected significance is step 3, where this procedure has to be repeated for a range of signal strengths to find the value which gives a median (and <span class="math notranslate nohighlight">\(\pm1\sigma,\pm2\sigma\)</span> quantile) <span class="math notranslate nohighlight">\(p_\mu'\)</span> of 0.05 - this is thus the minimum value of <span class="math notranslate nohighlight">\(\mu\)</span> that we expect to be able to exclude at 95% CL.
This is shown below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_toys</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">exp_s</span><span class="p">,</span> <span class="n">exp_b</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span>

<span class="c1"># saving p_muprime for each mu for each relevant quantile</span>
<span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>
<span class="n">p_muprimes</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">mus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">mus</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">exp_s</span>
    <span class="c1"># generate toys under signal + background hypothesis</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">get_toys_sb</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">exp_b</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
    <span class="c1"># sample q under s + b hypothesis</span>
    <span class="n">q_tilde_ss</span> <span class="o">=</span> <span class="n">q_tilde_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

    <span class="c1"># generate toys under background-only hypothesis</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">get_toys_sb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exp_b</span><span class="p">,</span> <span class="n">num_toys</span><span class="p">)</span>
    <span class="c1"># sample t_0 under b-only hypothesis</span>
    <span class="n">q_tilde_s0</span> <span class="o">=</span> <span class="n">q_tilde_s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

    <span class="n">qs0_quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">q_tilde_s0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="n">quantiles</span><span class="p">)</span>

    <span class="c1"># CL_s</span>
    <span class="n">p_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">q_tilde_ss</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">qs0_quantiles</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">p_b</span> <span class="o">=</span> <span class="n">quantiles</span>
    <span class="n">p_muprimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_mu</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_b</span><span class="p">))</span>

<span class="n">p_muprimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_muprimes</span><span class="p">)</span>
<span class="c1"># find the mu which gives the closest value to 0.05 for each quantile</span>
<span class="n">limits</span> <span class="o">=</span> <span class="n">mus</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p_muprimes</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># plot</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ylim</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">quantiles</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mus</span><span class="p">,</span> <span class="n">p_muprimes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">mus</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mus</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Quantiles&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mu$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$p_\mu&#39;$&quot;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">rl</span><span class="p">,</span> <span class="n">ru</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
        <span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rl</span><span class="p">),</span> <span class="n">limits</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ru</span> <span class="o">-</span> <span class="n">rl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\pm 2 \sigma$&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
        <span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rl</span><span class="p">),</span> <span class="n">limits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ru</span> <span class="o">-</span> <span class="n">rl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lime&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\pm 1 \sigma$&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rl</span><span class="p">,</span> <span class="n">ru</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Expected&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;95% CL$_s$ Limits&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mu$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">rl</span><span class="p">,</span> <span class="n">ru</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<figure class="align-default" id="explim2">
<img alt="_images/62984d133a44956d0e925eb9c71e99980f201cb51c9289e9212de2660e881acf.png" src="_images/62984d133a44956d0e925eb9c71e99980f201cb51c9289e9212de2660e881acf.png" />
<figcaption>
<p><span class="caption-number">Fig. 5.4 </span><span class="caption-text">Left: The expected median and <span class="math notranslate nohighlight">\(\pm1\sigma,\pm2\sigma\)</span> quantiles of <span class="math notranslate nohighlight">\(p_\mu'\)</span> for different <span class="math notranslate nohighlight">\(\mu\)</span>’s. The intersection of these with <span class="math notranslate nohighlight">\(p_\mu' = 0.05\)</span> (grey) corresponds to the expected exclusion limits. Right: The median and <span class="math notranslate nohighlight">\(\pm 1\sigma, \pm 2\sigma\)</span> expected limits at 95% CL<span class="math notranslate nohighlight">\(_s\)</span> on <span class="math notranslate nohighlight">\(\mu\)</span>.</span><a class="headerlink" href="#explim2" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<p>Thus, we have our expected limits.
The plot on the right is colloquially known as a “Brazil-band plot”, and is the standard way of representing limits.
For example, below is the corresponding plot by ATLAS for the Higgs discovery (scanning over the Higgs mass):</p>
<figure class="align-center" id="atlas-higgs">
<img alt="_images/atlas_limits.png" src="_images/atlas_limits.png" />
<figcaption>
<p><span class="caption-number">Fig. 5.5 </span><span class="caption-text">Expected and observed 95% CL<span class="math notranslate nohighlight">\(_s\)</span> upper limits for the SM Higgs by ATLAS in 2012, for different hypothetical Higgs masses <span id="id2">[<a class="reference internal" href="main.html#id8" title="ATLAS Collaboration. Observation of a new particle in the search for the Standard Model Higgs boson with the ATLAS detector at the LHC. Phys. Lett. B, 716:1–29, 2012. arXiv:1207.7214, doi:10.1016/j.physletb.2012.08.020.">5</a>]</span>.</span><a class="headerlink" href="#atlas-higgs" title="Link to this image">#</a></p>
</figcaption>
</figure>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>Reference <span id="id3">[<a class="reference internal" href="main.html#id6" title="Kyle Cranmer. Practical Statistics for the LHC. In 2011 European School of High-Energy Physics, 267–308. 2014. arXiv:1503.07622, doi:10.5170/CERN-2014-003.267.">2</a>]</span>’s suggestion is to use the profiled values of the nuisance parameters given the full observations, i.e., <span class="math notranslate nohighlight">\(\hat{\hat{b}}(\mu, n_\mathrm{obs}, m_\mathrm{obs})\)</span>, where <span class="math notranslate nohighlight">\(\mu\)</span> depends on the assumed hypothesis; however, personally, I don’t find this very general since often in CMS we don’t have access to these observations when we’re trying to derive the expected significance.</p>
</aside>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One subtlety we skipped over is that we may not have expected values for the nuisance parameters, like <span class="math notranslate nohighlight">\(b\)</span>, beforehand. In practice, there are a lot of methods developed for estimating these using simulations, or observed data in control regions (e.g. from observing only <span class="math notranslate nohighlight">\(m\)</span> in our case), etc., which generally depend on the specific analysis being performed.</p>
</div>
</section>
<section id="summary">
<h2><span class="section-number">5.4. </span>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>We derived the “expected significance” of a particular signal model by calculating the significance with which we expect to exclude the background-only hypothesis, assuming the signal exists.
We then derived CL<span class="math notranslate nohighlight">\(_s\)</span> upper limits we expect to set for a signal model, assuming the signal does <em>not</em> exist.
In both cases, we generated toys to estimate the probability distributions of our test statistics; however, in <a class="reference internal" href="05-asymptotic-form-mle.html"><span class="std std-doc">Part II</span></a>, we will go over <em>asymptotic forms</em> for these test statistics, which can often be simpler to use.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="03-intervals-and-limits.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4. </span>Confidence Intervals and Limits</p>
      </div>
    </a>
    <a class="right-next"
       href="05-asymptotic-form-mle.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6. </span>Asymptotic Form of the MLE</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">5.1. Recap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-significance">5.2. Expected Significance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-limit">5.3. Expected Limit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">5.4. Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Raghav Kansal
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>